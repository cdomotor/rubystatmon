<%# File: app/views/stations/_station.html.erb %>
<%# Path: /app/views/stations/_station.html.erb %>
<% last_ping = station.ping_results.last %>

<div id="<%= dom_id(station) %>" class="bg-gray-100 border rounded-md shadow-xs p-3" data-controller="stopclick">
  <!-- Row 1: Station name + active badge -->
  <div class="flex items-center gap-2">
    <h2 class="text-base font-semibold text-gray-900 truncate">
      <%= link_to (station.name.presence || "Unnamed Station"),
                  station_path(station),
                  class: "hover:underline" %>
      <% if station.respond_to?(:status) && station.status.present? %>
        <span class="ml-1 text-xs text-gray-500">(<%= station.status %>)</span>
      <% end %>
    </h2>

    <% if station.active? %>
      <span class="px-2 py-0.5 text-[11px] font-medium rounded bg-green-100 text-green-700">Active</span>
    <% else %>
      <span class="px-2 py-0.5 text-[11px] font-medium rounded bg-gray-200 text-gray-700">Inactive</span>
    <% end %>
  </div>

<div class="mt-2 text-xs text-gray-600">
  <span class="mr-3">IP: <%= station.ip_address.presence || "—" %></span>
  <% if last_ping %>
    <span class="mr-3">Last ping: <%= l(last_ping.created_at, format: :short) %></span>
    <% if last_ping.success %>
      <span class="mr-3 text-green-600">✅ ok</span>
    <% else %>
      <span class="mr-3 text-red-600">❌ fail</span>
    <% end %>
  <% end %>
</div>

  <div class="mt-3 flex items-center gap-2">
    <!-- Toggle Active (Turbo PATCH) -->
    <%= button_to (station.active? ? "Deactivate" : "Activate"),
                  toggle_active_station_path(station),
                  method: :patch,
                  form: { data: { turbo: true } },
                  data: { action: "click->stopclick#stop" },
                  class: "px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700" %>

    <!-- Delete (Turbo DELETE) -->
    <%= button_to "Delete",
                  station_path(station),
                  method: :delete,
                  form: { data: { turbo_confirm: "Delete this station?" } },
                  data: { action: "click->stopclick#stop" },
                  class: "px-3 py-1 rounded bg-red-600 text-white hover:bg-red-700" %>

    <!-- Optional: Ping (Turbo POST) -->
    <%= button_to "Ping",
                  ping_station_path(station),
                  method: :post,
                  form: { data: { turbo: true } },
                  data: { action: "click->stopclick#stop" },
                  class: "px-3 py-1 rounded bg-gray-800 text-white hover:bg-black" %>
  </div>
</div>
